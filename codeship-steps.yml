- name: test
  service: app
  command: go test -v ./...

- name: push_develop_timestamp
  service: app
  type: push
  image_name: 369020531563.dkr.ecr.us-east-1.amazonaws.com/handcarry-stg
  image_tag: "{{.Timestamp}}"
  tag: develop
  registry: https://369020531563.dkr.ecr.us-east-1.amazonaws.com
  dockercfg_service: awsgenerator

- name: push_develop_develop
  service: app
  type: push
  image_name: 369020531563.dkr.ecr.us-east-1.amazonaws.com/handcarry-stg
  image_tag: "develop"
  tag: develop
  registry: https://369020531563.dkr.ecr.us-east-1.amazonaws.com
  dockercfg_service: awsgenerator

#- name: push_production_timestamp
#  service: app
#  type: push
#  image_name: 369020531563.dkr.ecr.us-east-1.amazonaws.com/handcarry-prod
#  image_tag: "{{.Timestamp}}"
#  tag: master
#  registry: https://369020531563.dkr.ecr.us-east-1.amazonaws.com
#  dockercfg_service: awsgenerator
#
#- name: push_production_latest
#  service: app
#  type: push
#  image_name: 369020531563.dkr.ecr.us-east-1.amazonaws.com/handcarry-prod
#  image_tag: "latest"
#  tag: master
#  registry: https://369020531563.dkr.ecr.us-east-1.amazonaws.com
#  dockercfg_service: awsgenerator

- name: deploy_staging_web
  service: ecsdeploy
  tag: develop
  command: "-c appsdev-stg -n handcarry-api -i 369020531563.dkr.ecr.us-east-1.amazonaws.com/handcarry-stg -e CI_TIMESTAMP -t 600"

#- name: deploy_production_web
#  service: ecsdeploy
#  tag: master
#  command: "-c appsdev-prod -n handcarry-api -i 369020531563.dkr.ecr.us-east-1.amazonaws.com/handcarry-prod -e CI_TIMESTAMP -t 600"

- name: track_deployment
  service: tracker
  tag: ^(master|develop)
  command: "true"
